/**
 * Global Script Viewer v1.0
 * https://github.com/bsweat/global-script-viewer
 * 
 * Â© 2013, Brian Sweat
 * http://bsweat.com
 * 
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 */

(function(){var p=[],removedScripts=[],allScripts=document.getElementsByTagName('script'),status='Head',viewer=document.createDocumentFragment(),wrapper=document.createElement('div'),wrapStyle=wrapper.style,css='',url=window.location.hostname,style=document.createElement('style'),head=document.getElementsByTagName('head')[0],DOMready=function(){function c(){o=true;if(r){t.removeEventListener("DOMContentLoaded",c,false)}while(s=i.shift()){s()}}var e=window,t=e.document,n=t.createElement,r=!!t.addEventListener,i=[],s,o,u,a,f,l=function(){var e,n=3,r=t.createElement("div"),i=r.getElementsByTagName("i");while(r.innerHTML="<!--[if gt IE "+ ++n+"]><i></i><![endif]-->",i[0]);return n>4?n:e}();return function(s){if(o){return s()}if(r){t.addEventListener("DOMContentLoaded",c,false)}else if(l<9){a=e.setInterval(function(){if(t.body){try{n("div").doScroll("left");e.clearInterval(a)}catch(r){return}c();return}},10);function h(){if(t.readyState=="complete"){t.detachEvent("onreadystatechange",h);e.clearInterval(a);e.clearInterval(f);c()}}t.attachEvent("onreadystatechange",h);f=e.setInterval(function(){h()},10)}u=function(){c();if(r){t.removeEventListener("load",u,false)}else{t.detachEvent("onload",u)}};if(r){t.addEventListener("load",u,false)}else{t.attachEvent("onload",u)}i.push(s)}}();css='#script-viewer {position: fixed;top: 0;left: 0;display: block;height: 100%;width:600px;color: #ddd;z-index: 99998;overflow: hidden;background: #000;-moz-box-shadow: 0 0 30px #888;-webkit-box-shadow: 0 0 30px #888;box-shadow: 0 0 30px #888;background: rgba(0,0,0,0.85);font-family:helvetica, sans-serif;}#script-viewer * {color:#ddd;line-height:1.75em;text-align:left;word-wrap:break-word;margin:0;padding:0;font-family:helvetica, sans-serif;}#script-viewer #script-lists {overflow-y:scroll;display:block;height:85%;}#script-viewer ul {padding:0;margin:0 0 15px 0;border-bottom:1px solid #666;}#script-viewer ul li {margin:0;padding:0;overflow:hidden;display:block;}#script-viewer ul li div {padding:5px 5px 5px 10px;margin - bottom:10px;}#script-viewer ul li.file div h3{font-size:15px;color:#6f6;}#script-viewer ul li.inline div h3{font-size:15px;color:#f6c;}#script-viewer ul li.removed div h3{color:#f00;}#script-viewer ul li div h3 span {font-weight:100;color:#ddd;}#script-viewer ul li div p {font-size:10px;}#script-viewer ul li.inline div p {color: #ffc;}#script-viewer ul li.inline div p span {color:#ddd;}#script-viewer ul li div p span {color:#ccc;}#script-viewer ul a {color:#6cf;}#script-viewer ul a:hover {color:#6ff;}#script-viewer ul h2 {text-align:center;font-size:21px;padding: 10px 0;}#script-info {text-align:center;border-bottom: 1px solid #666;background:#000;height:15%;padding-left:15px;}#script-info h2 {font-size:30px;font-weight:100;padding: 20px 0 0 0;}#script-info h3 {font-size:14px;font-weight:100;}#script-info h3 span {color:#0ff;font-weight:800;}#script-info h2 span {color:#f0f;font-weight:800;}';css.replace(/ +?/g,'');wrapper.id='script-viewer';viewer.appendChild(wrapper);style.type='text/css';if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}function DOMNodeInsertedHandler(a){if(a.target.tagName==='SCRIPT'){p.push({node:a.target.cloneNode(),timing:status})}}function DOMNodeRemovedHandler(a){if(a.target.tagName==='SCRIPT'){removedScripts.push({node:{src:a.srcElement.src,innerHTML:a.srcElement.innerHTML},timing:status})}}document.addEventListener('DOMNodeInserted',DOMNodeInsertedHandler,true);document.addEventListener('DOMNodeRemoved',DOMNodeRemovedHandler,true);function htmlEscape(a){return String(a).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}var q=function(){var a=setTimeout(function(){if(status==='Head'){if(document.body){document.body.appendChild(viewer);head.appendChild(style);status='Document Loading'}else if(status==='DOM Ready'){clearTimeout(a)}else{q()}}},10);DOMready(function(){status='DOM Ready'});window.onload=function(){status='Window Loaded'}};var v=function(l,m,n){return setTimeout(function(){var d=document.createDocumentFragment(),listWrap=document.createElement('div'),headList=document.createElement('ul'),headTitle=document.createElement('h2'),bodyList=document.createElement('ul'),bodyTitle=document.createElement('h2'),deletedList=document.createElement('ul'),deletedTitle=document.createElement('h2'),info=document.createElement('div'),total=document.createElement('h2'),counts=document.createElement('h3'),inline=0,files=0,third=0;total.innerHTML='Number of Scripts: <span>'+allScripts.length+'.</span>';headTitle.innerHTML='Head Scripts';bodyTitle.innerHTML='Body Scripts';deletedTitle.innerHTML='Removed Scripts';listWrap.id='script-lists';headList.id='head-list';headList.appendChild(headTitle);bodyList.appendChild(bodyTitle);deletedList.appendChild(deletedTitle);for(var i=0;i<allScripts.length;i++){var e=document.createElement('li'),div=document.createElement('div'),scriptLocation=allScripts[i].parentNode.nodeName,title=document.createElement('h3'),count=document.createElement('span'),inserted=false,insertTime='';e.className='script';if(p.length){for(var j=0;j<p.length;j++){if(p[j].node.isEqualNode(allScripts[i])){inserted=true}}if(inserted===true){insertTime=status;e.className=e.className+' inserted'}}if(allScripts[i].src){var f=var f=(allScripts[i].src.match(/[^/]+$/g)!==null)?(allScripts[i].src.match(/[^/]+$/g)):(allScripts[i].src),trim=(f[0].length>50)?(f[0].substr(0,50)+'...'):(f[0]),scriptUrl=allScripts[i].src,loc='Internal',fullUrl=document.createElement('p');if(allScripts[i].src.lastIndexOf(url)===-1||allScripts[i].src.lastIndexOf(url)>9){third=third+1;loc='External'}e.className=e.className+' file';count.innerHTML=(i+1)+'. ';fullUrl.innerHTML='<span>File Path:</span> <a target="_blank" href="'+scriptUrl+'">'+scriptUrl+'</a>';title.appendChild(count);title.innerHTML=title.innerHTML+' '+trim+'<span> : '+loc+'</span>'+((inserted===true)?('<span> & Injected @ '+insertTime+'</span>'):(''));div.appendChild(title);div.appendChild(fullUrl);files=files+1}else if(allScripts[i].innerHTML){var h=htmlEscape(allScripts[i].innerHTML),jsSnippet=document.createElement('p');e.className=e.className+' inline';jsSnippet.innerHTML='<span>Script Snippet: </span>'+h;inline=inline+1;count.innerHTML=(i+1)+'. ';title.appendChild(count);title.innerHTML=title.innerHTML+'Inline Script';div.appendChild(title);div.appendChild(jsSnippet)}e.appendChild(div);if(scriptLocation==='HEAD'){headList.appendChild(e)}else{bodyList.appendChild(e)}}function runRemoved(){for(var i=0;i<removedScripts.length;i++){var a=document.createElement('li'),div=document.createElement('div'),title=document.createElement('h3');a.className='script';if(removedScripts[i].node.src){var b=removedScripts[i].node.src.match(/[^/]+$/g),trim=(b[0].length>30)?(b[0].substr(0,30)+'...'):(b[0]),scriptUrl=removedScripts[i].node.src,loc='Internal',fullUrl=document.createElement('p');a.className=a.className+' removed file';fullUrl.innerHTML='<span>File Path:</span> <a target="_blank" href="'+scriptUrl+'">'+scriptUrl+'</a>';title.innerHTML=title.innerHTML+' '+trim+'<span> : Removed Script File</span>'+'<span> @ '+removedScripts[i].timing+'</span>';div.appendChild(title);div.appendChild(fullUrl)}else if(removedScripts[i].node.innerHTML){var c=htmlEscape(removedScripts[i].node.innerHTML),jsSnippet=document.createElement('p');a.className=a.className+' removed inline';jsSnippet.innerHTML=c;title.innerHTML=title.innerHTML+'Removed Inline Script'+'<span> @ '+removedScripts[i].timing+'</span>';div.appendChild(title);div.appendChild(jsSnippet)}a.appendChild(div);deletedList.appendChild(a)}}if(removedScripts.length){runRemoved()}counts.innerHTML='Script Files: <span>'+files+'</span>. Inline Scripts: <span>'+inline+'</span>. Injected: <span>'+p.length+'</span>. Removed: <span>'+removedScripts.length+'</span>. External Files: <span>'+third+'</span>.';info.id='script-info';info.appendChild(total);info.appendChild(counts);listWrap.appendChild(headList);listWrap.appendChild(bodyList);listWrap.appendChild(deletedList);d.appendChild(info);d.appendChild(listWrap);if((status==='DOM Ready'||status==='Document Loading'||status==='Window Loaded')&&(l!==allScripts.length||m!==p.length||n!==removedScripts.length)){document.getElementById('script-viewer').innerHTML='';document.getElementById('script-viewer').appendChild(d)}var k=allScripts.length,oldAdded=p.length,oldRemoved=removedScripts.length;v(k,oldAdded,oldRemoved)},100)};q();v()})();