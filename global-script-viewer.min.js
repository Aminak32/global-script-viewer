/**
 * Global Script Viewer v1.0
 * https://github.com/bsweat/global-script-viewer
 * 
 * Â© 2013, Brian Sweat
 * http://bsweat.com
 * 
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 */

(function(){function m(b){"SCRIPT"===b.target.tagName&&a.push({node:b.target.cloneNode(),timing:d})}function n(a){"SCRIPT"===a.target.tagName&&b.push({node:{src:a.srcElement.src,innerHTML:a.srcElement.innerHTML},timing:d})}function o(a){return(a+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var a=[],b=[],c=document.getElementsByTagName("script"),d="Head",e=document.createDocumentFragment(),f=document.createElement("div"),h=(f.style,""),i=window.location.hostname,j=document.createElement("style"),k=document.getElementsByTagName("head")[0],l=function(){function a(){for(h=!0,e&&c.removeEventListener("DOMContentLoaded",a,!1);g=f.shift();)g()}var g,h,i,j,k,b=window,c=b.document,d=c.createElement,e=!!c.addEventListener,f=[],l=function(){for(var a,b=3,d=c.createElement("div"),e=d.getElementsByTagName("i");d.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",e[0];);return b>4?b:a}();return function(g){function m(){"complete"==c.readyState&&(c.detachEvent("onreadystatechange",m),b.clearInterval(j),b.clearInterval(k),a())}return h?g():(e?c.addEventListener("DOMContentLoaded",a,!1):9>l&&(j=b.setInterval(function(){if(c.body){try{d("div").doScroll("left"),b.clearInterval(j)}catch(e){return}return a(),void 0}},10),c.attachEvent("onreadystatechange",m),k=b.setInterval(function(){m()},10)),i=function(){a(),e?c.removeEventListener("load",i,!1):c.detachEvent("onload",i)},e?c.addEventListener("load",i,!1):c.attachEvent("onload",i),f.push(g),void 0)}}();h="#script-viewer {position: fixed;top: 0;left: 0;display: block;height: 100%;width:600px;color: #ddd;z-index: 99998;overflow: hidden;background: #000;-moz-box-shadow: 0 0 30px #888;-webkit-box-shadow: 0 0 30px #888;box-shadow: 0 0 30px #888;background: rgba(0,0,0,0.85);font-family:helvetica, sans-serif;}#script-viewer * {color:#ddd;line-height:1.75em;text-align:left;word-wrap:break-word;margin:0;padding:0;font-family:helvetica, sans-serif;}#script-viewer #script-lists {overflow-y:scroll;display:block;height:85%;}#script-viewer ul {padding:0;margin:0 0 15px 0;border-bottom:1px solid #666;}#script-viewer ul li {margin:0;padding:0;overflow:hidden;display:block;}#script-viewer ul li div {padding:5px 5px 5px 10px;margin - bottom:10px;}#script-viewer ul li.file div h3{font-size:15px;color:#6f6;}#script-viewer ul li.inline div h3{font-size:15px;color:#f6c;}#script-viewer ul li.removed div h3{color:#f00;}#script-viewer ul li div h3 span {font-weight:100;color:#ddd;}#script-viewer ul li div p {font-size:10px;}#script-viewer ul li.inline div p {color: #ffc;}#script-viewer ul li.inline div p span {color:#ddd;}#script-viewer ul li div p span {color:#ccc;}#script-viewer ul a {color:#6cf;}#script-viewer ul a:hover {color:#6ff;}#script-viewer ul h2 {text-align:center;font-size:21px;padding: 10px 0;}#script-info {text-align:center;border-bottom: 1px solid #666;background:#000;height:15%;padding-left:15px;}#script-info h2 {font-size:30px;font-weight:100;padding: 20px 0 0 0;}#script-info h3 {font-size:14px;font-weight:100;}#script-info h3 span {color:#0ff;font-weight:800;}#script-info h2 span {color:#f0f;font-weight:800;}",h.replace(/ +?/g,""),f.id="script-viewer",e.appendChild(f),j.type="text/css",j.styleSheet?j.styleSheet.cssText=h:j.appendChild(document.createTextNode(h)),document.addEventListener("DOMNodeInserted",m,!0),document.addEventListener("DOMNodeRemoved",n,!0);var p=function(){var a=setTimeout(function(){"Head"===d&&(document.body?(document.body.appendChild(e),k.appendChild(j),d="Document Loading"):"DOM Ready"===d?clearTimeout(a):p())},10);l(function(){d="DOM Ready"}),window.onload=function(){d="Window Loaded"}},q=function(e,f,g){return setTimeout(function(){function O(){for(var a=0;b.length>a;a++){var c=document.createElement("li"),d=document.createElement("div"),e=document.createElement("h3");if(c.className="script",b[a].node.src){var f=b[a].node.src.match(/[^/]+$/g),g=f[0].length>30?f[0].substr(0,30)+"...":f[0],h=b[a].node.src,j=document.createElement("p");c.className=c.className+" removed file",j.innerHTML='<span>File Path:</span> <a target="_blank" href="'+h+'">'+h+"</a>",e.innerHTML=e.innerHTML+" "+g+"<span> : Removed Script File</span>"+"<span> @ "+b[a].timing+"</span>",d.appendChild(e),d.appendChild(j)}else if(b[a].node.innerHTML){var k=o(b[a].node.innerHTML),l=document.createElement("p");c.className=c.className+" removed inline",l.innerHTML=k,e.innerHTML=e.innerHTML+"Removed Inline Script"+"<span> @ "+b[a].timing+"</span>",d.appendChild(e),d.appendChild(l)}c.appendChild(d),p.appendChild(c)}}var h=document.createDocumentFragment(),j=document.createElement("div"),k=document.createElement("ul"),l=document.createElement("h2"),m=document.createElement("ul"),n=document.createElement("h2"),p=document.createElement("ul"),r=document.createElement("h2"),s=document.createElement("div"),t=document.createElement("h2"),u=document.createElement("h3"),v=0,w=0,x=0;t.innerHTML="Number of Scripts: <span>"+c.length+".</span>",l.innerHTML="Head Scripts",n.innerHTML="Body Scripts",r.innerHTML="Removed Scripts",j.id="script-lists",k.id="head-list",k.appendChild(l),m.appendChild(n),p.appendChild(r);for(var y=0;c.length>y;y++){var z=document.createElement("li"),A=document.createElement("div"),B=c[y].parentNode.nodeName,C=document.createElement("h3"),D=document.createElement("span"),E=!1,F="";if(z.className="script",a.length){for(var G=0;a.length>G;G++)a[G].node.isEqualNode(c[y])&&(E=!0);E===!0&&(F=d,z.className=z.className+" inserted")}if(c[y].src){var H=c[y].src.match(/[^/]+$/g),I=H[0].length>50?H[0].substr(0,50)+"...":H[0],J=c[y].src,K="Internal",L=document.createElement("p");(-1===c[y].src.lastIndexOf(i)||c[y].src.lastIndexOf(i)>9)&&(x+=1,K="External"),z.className=z.className+" file",D.innerHTML=y+1+". ",L.innerHTML='<span>File Path:</span> <a target="_blank" href="'+J+'">'+J+"</a>",C.appendChild(D),C.innerHTML=C.innerHTML+" "+I+"<span> : "+K+"</span>"+(E===!0?"<span> & Injected @ "+F+"</span>":""),A.appendChild(C),A.appendChild(L),w+=1}else if(c[y].innerHTML){var M=o(c[y].innerHTML),N=document.createElement("p");z.className=z.className+" inline",N.innerHTML="<span>Script Snippet: </span>"+M,v+=1,D.innerHTML=y+1+". ",C.appendChild(D),C.innerHTML=C.innerHTML+"Inline Script",A.appendChild(C),A.appendChild(N)}z.appendChild(A),"HEAD"===B?k.appendChild(z):m.appendChild(z)}b.length&&O(),u.innerHTML="Script Files: <span>"+w+"</span>. Inline Scripts: <span>"+v+"</span>. Injected: <span>"+a.length+"</span>. Removed: <span>"+b.length+"</span>. External Files: <span>"+x+"</span>.",s.id="script-info",s.appendChild(t),s.appendChild(u),j.appendChild(k),j.appendChild(m),j.appendChild(p),h.appendChild(s),h.appendChild(j),"DOM Ready"!==d&&"Document Loading"!==d&&"Window Loaded"!==d||e===c.length&&f===a.length&&g===b.length||(document.getElementById("script-viewer").innerHTML="",document.getElementById("script-viewer").appendChild(h));var P=c.length,Q=a.length,R=b.length;q(P,Q,R)},100)};p(),q()})();